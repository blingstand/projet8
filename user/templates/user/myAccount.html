{% extends 'user/base.html' %}

{% block content %}
<header class="masthead-account">
	
	<div class="container">
		<div class="row">
			<div class="col-lg-3"></div>
			<div class="col-lg-6 opac_white_background">
				<h2 class="text-center mt-0 account">Bienvenue {{request.user.username}} ! </h2>
				{% if mail_confirm_sent%}
					{% if mail_confirmed %}
					<p class="text-center"> Tu m'as communiqué ce mail : {{user_mail}}</p>
					{% else %}
					<h4 class="text-center mt-0 account">Il semblerait que je n'ai pas encore reçu ta confirmation ... </h4>
					{% for message in messages %}
						<p class="text-center">{{message}}</p>
					{% endfor %}
					<p> Mail de confirmation envoyé à cette adresse {{ user_mail}}, j'attends ta réponse</p>
					<a href="{% url 'user:myAccount'%}/new_mail">Fournir un nouveau mail</a >
					{% endif%}
				{% else %}
				<h4 class="text-center mt-0 account">Il semblerait que je n'ai pas ton mail ... </h4>
				<form class="white-bg" action="" method='POST'>
					{% csrf_token %}
					<div class="form-row">
						<div class="col-lg-1"></div>
						<div class="col-lg-4"><p>{{ form.mail.label}}</p>	</div>
						<div class="col-lg-4"><p>{{ form.mail}}</p><p id="check_mail"></p></div>
						<div class="col-lg-3"></div>		
					</div>
					
					<div class="account_input">
						<div >
							<input type="submit" class="btn btn-primary account" value="Envoyer les infos complémentaires">
						</div>
					</div>
				</form>
				{% endif%}
			</div>
			<div class="col-lg-3"></div>
		</div>
	</div>
</div>
</header>
<script>

		//improve form
		let mail_field = document.getElementById('id_mail')
		mail_field.placeholder='(Facultatif) > utilisateur@domaine.fr';
		mail_field.style.width='19em';
		const regex_mail = /^[\w.+-]{1,64}@[a-zA-Z\d-]{3,252}\.[a-zA-Z\.]{2,6}/;
		const check_mail_field = document.getElementById('check_mail')

		const form = document.querySelector("form");
		form.addEventListener("submit", function (e) {
			//check the mail
			let validiteCourriel = "";
			if (regex_mail.test(mail_field.value) == false) {
		        // Le courriel saisi ne contient pas le caractère @
		        validiteCourriel = "vérifie ton mail";
		        mail_field.style.border = "2px red solid";
		        check_mail_field.style.color = "red";
		        check_mail_field.textContent = validiteCourriel; 
		        
		        e.preventDefault()
		    }
		})


	</script>
	{% endblock %}